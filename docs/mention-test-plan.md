# /mention 機能テスト計画

## テスト対象機能と理想的な挙動

### 1. コマンド実行テスト

#### /mention（デフォルト）
- **理想の挙動**: 過去48時間以内のメンション4件が表示される
- **確認項目**:
  - 時系列順（新しい順）で表示
  - 各メンションに時間表示（1時間前、6時間前など）
  - 重要度マーク（[URGENT]、[MEDIUM]）が適切に表示
  - メッセージ本文が100文字で切り詰め表示

#### /mention all
- **理想の挙動**: すべてのメンション6件が表示される
- **確認項目**:
  - 返信済み・タスク化済みも含めて表示
  - 48時間を超えるメンションも表示

#### /mention unread
- **理想の挙動**: 未返信のメンション5件のみ表示される
- **確認項目**:
  - 返信済み（高橋からのメンション）が除外される
  - タスク化済みでも未返信なら表示される

### 2. ボタンアクションテスト

#### 「返信案」ボタン
- **理想の挙動**: AI生成の返信候補3つが表示される
- **テストシナリオ**:
  1. **緊急対応** → 迅速な対応を示す返信案
  2. **会議調整** → 日程確認・提案を含む返信案
  3. **コードレビュー** → 技術的な返信案
  4. **簡単な質問** → 簡潔な回答案
- **確認項目**:
  - 返信案がコードブロック（```）で表示
  - 各返信案に「案1」「案2」「案3」のラベル
  - 「💬 スレッドで返信する」ボタンが表示（実際のSlackでは無効）

#### 「タスク化」ボタン
- **理想の挙動**: メンションからタスクが作成される
- **確認項目**:
  - タスクタイトルが「Reply to #channel: メッセージ冒頭...」形式
  - 優先度が重要度に応じて設定（high→P1、medium→P2、low→P3）
  - 「[OK] タスクを作成しました」メッセージ表示
  - 同じメンションを再度タスク化しようとしてもエラーにならない

#### 「既読」ボタン
- **理想の挙動**: メンションがアーカイブされる
- **確認項目**:
  - 「[OK] 既読にしました」メッセージ表示
  - 次回の/mentionコマンドで表示されなくなる

#### 「→」ボタン
- **理想の挙動**: Slackのスレッドへのリンク（テスト環境では機能しない）
- **確認項目**:
  - ボタンが表示される
  - クリックしても画面遷移しない（テスト環境）

### 3. エラー処理テスト

#### データベース接続エラー
- **理想の挙動**: 「[ERROR] Failed to process mention command」表示

#### 権限不足エラー
- **理想の挙動**: 適切なエラーメッセージ表示

### 4. パフォーマンステスト

#### 大量メンション処理
- **理想の挙動**: 20件以上のメンションでも適切に表示制限
- **確認項目**: 最新20件のみ表示される

## テスト実行手順

### Phase 1: 基本機能テスト
1. `/mention` を実行 → 4件表示を確認
2. `/mention all` を実行 → 6件表示を確認
3. `/mention unread` を実行 → 5件表示を確認

### Phase 2: アクションテスト
1. 緊急メンション（山田太郎）の「返信案」をクリック
   - AI返信案が生成されることを確認
2. 会議依頼（佐藤部長）の「タスク化」をクリック
   - タスクが作成されることを確認
3. 簡単な質問（田中）の「既読」をクリック
   - アーカイブされることを確認

### Phase 3: 状態確認テスト
1. タスク化後、再度 `/mention` を実行
   - タスク化済みメンションも表示されることを確認
2. 既読にした後、再度 `/mention` を実行
   - 既読メンションが表示されないことを確認
3. `/mention unread` を実行
   - 既読・返信済みが除外されることを確認

### Phase 4: エッジケーステスト
1. 同じメンションを複数回タスク化
2. 返信案生成を連続実行
3. すべてのメンションを既読にした後の表示

## 期待される結果サマリー

| テストケース | 期待結果 | 備考 |
|------------|---------|------|
| /mention | 4件表示（48時間以内） | 返信済み・タスク化済みも含む |
| /mention all | 6件すべて表示 | 時間制限なし |
| /mention unread | 5件表示 | 返信済み（高橋）除外 |
| 返信案生成 | 3つの返信候補表示 | メンション内容に応じた返信 |
| タスク化 | タスク作成成功 | 優先度自動設定 |
| 既読 | アーカイブ成功 | 次回表示されない |

## 注意事項
- permalink（→ボタン）はテスト環境では動作しない
- テストデータには[TEST]プレフィックスが付いている
- 実際のSlackチャンネルは存在しないため、一部機能は制限される